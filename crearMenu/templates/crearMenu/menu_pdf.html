<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @page { size: letter landscape; margin: 2cm; } /* Hoja horizontal para que quepa todo */
        body { font-family: Helvetica, sans-serif; font-size: 10px; color: #333; }
        h1 { text-align: center; color: #000; border-bottom: 2px solid #000; padding-bottom: 10px; }
        
        /* Caja de Info del Menú */
        .info-box { width: 100%; margin-bottom: 20px; background: #f4f4f4; padding: 10px; border: 1px solid #ddd; }
        .info-box p { margin: 3px 0; font-size: 11px; }

        /* Tabla Principal */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        th { background-color: #333; color: #fff; padding: 8px; text-align: left; font-weight: bold; font-size: 11px; }
        td { border-bottom: 1px solid #ccc; padding: 8px; vertical-align: top; word-wrap: break-word; }
        
        /* Anchos de columna específicos (Total 100%) */
        .col-plato { width: 25%; }
        .col-cat { width: 10%; }
        .col-receta { width: 30%; }
        .col-nutri { width: 20%; }
        .col-precio { width: 15%; }

        /* Estilos internos */
        .ingredientes-list { font-size: 9px; color: #555; font-style: italic; margin-top: 4px; }
        .nutri-table td { border: none; padding: 1px; font-size: 9px; }
    </style>
</head>
<body>
    <h1>Menú: {{ menu.nombre }}</h1>

    <div class="info-box">
        <p><strong>Restaurante:</strong> {{ menu.restaurante.nombre }} | <strong>Ubicación:</strong> {{ menu.restaurante.ubicacion }}</p>
        <p><strong>Chef:</strong> {{ menu.chef.nombre }} | <strong>Tipo:</strong> {{ menu.tipo_menu.descripcion }}</p>
    </div>

    <table>
        <thead>
            <tr>
                <th class="col-plato">Plato e Ingredientes</th>
                <th class="col-cat">Categoría</th>
                <th class="col-receta">Proceso (Receta)</th>
                <th class="col-nutri">Detalle Nutricional</th>
                <th class="col-precio">Precio</th>
            </tr>
        </thead>
        <tbody>
            {% for detalle in detalles %}
            <tr>
                <td>
                    <strong>{{ detalle.plato.nombre }}</strong>
                    <div class="ingredientes-list">
                        Ingredientes:
                        {% for det_ing in detalle.plato.receta.detalleingrediente_set.all %}
                            {{ det_ing.ingrediente.nombre }} ({{ det_ing.cantidad|floatformat:0 }}g){% if not forloop.last %}, {% endif %}
                        {% empty %}
                            No especificados.
                        {% endfor %}
                    </div>
                </td>

                <td>{{ detalle.plato.categoria.nombre|default:"General" }}</td>

                <td>
                    {% if detalle.plato.receta %}
                        {{ detalle.plato.receta.proceso|truncatechars:150 }}
                    {% else %}
                        Sin receta.
                    {% endif %}
                </td>

                <td>
                    {% if detalle.plato.detallenutricional %}
                    <table class="nutri-table">
                        <tr><td>Calorías:</td><td><strong>{{ detalle.plato.detallenutricional.caloria|floatformat:0 }} kcal</strong></td></tr>
                        <tr><td>Proteína:</td><td>{{ detalle.plato.detallenutricional.proteina|floatformat:1 }}g</td></tr>
                        <tr><td>Carbos:</td><td>{{ detalle.plato.detallenutricional.carbohidratos|floatformat:1 }}g</td></tr>
                        <tr><td>Grasa:</td><td>{{ detalle.plato.detallenutricional.grasa|floatformat:1 }}g</td></tr>
                    </table>
                    {% else %}
                    <span style="color:#999;">No registrado</span>
                    {% endif %}
                </td>

                <td style="text-align: right; font-size: 12px;">
                    <strong>${{ detalle.precio }}</strong>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" style="text-align: center;">Este menú no tiene platos asignados.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>