{% extends 'crearMenu/base.html' %}

{% block title %}Gestionar {{ menu.nombre }}{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4 border-start border-4 border-primary">
    <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
        <div>
            <h2 class="h4 mb-1">{{ menu.nombre }}</h2>
            <p class="text-muted mb-0">
                Chef: <strong>{{ menu.chef.nombre }}</strong> | 
                Restaurante: <strong>{{ menu.restaurante.nombre }}</strong>
            </p>
        </div>
        <div>
            <a href="{% url 'crearMenu:imprimir_menu_pdf' menu.id_menu %}" class="btn btn-dark" target="_blank">
                üñ®Ô∏è Descargar PDF
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-secondary text-white">
                <h5 class="h6 mb-0">A√±adir Plato al Men√∫</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="id_plato" class="form-label">Seleccionar Plato:</label>
                        <select name="plato" id="id_plato" class="form-select" required>
                            <option value="">-- Buscar Plato --</option>
                            {% for plato in platos_disponibles %}
                            <option value="{{ plato.id_plato }}">{{ plato.nombre }} ({{ plato.categoria.nombre|default:"Gral" }})</option>
                            {% endfor %}
                        </select>
                        <div class="form-text"><a href="{% url 'crearMenu:crear_plato' %}">¬øNo encuentras el plato? Cr√©alo aqu√≠.</a></div>
                    </div>
                    <div class="mb-3">
                        <label for="id_precio" class="form-label">Precio de Venta ($):</label>
                        <input type="number" name="precio" id="id_precio" class="form-control" step="0.01" required placeholder="0.00">
                    </div>
                    <button type="submit" class="btn btn-success w-100">A√±adir</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="h6 mb-0">Contenido del Men√∫</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Plato</th>
                            <th>Precio</th>
                            <th style="width: 100px;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detalle in detalles %}
                        <tr>
                            <td>{{ detalle.plato.nombre }}</td>
                            <td>${{ detalle.precio }}</td>
                            <td>
                                <a href="{% url 'crearMenu:eliminar_detalle' detalle.pk %}" 
                                   class="btn btn-danger btn-sm"
                                   onclick="return confirm('¬øQuitar este plato del men√∫?');">
                                Eliminar</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="text-center py-4 text-muted">Este men√∫ est√° vac√≠o. ¬°A√±ade platos!</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}